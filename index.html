<!-- Merged 2025_10_11 -->
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" href="data:;base64,iVBORw0KGgo="><style>/* c.css */
:root{color-scheme: light dark;--base_size:13px;--light:hsl(60, 70%, 98%);--dark:hsl(15, 5%, 10%);--bg:light-dark(hsl(60, 25%, 95%),hsl(15, 5%, 10%));--fg:light-dark(hsl(15, 5%, 10%),hsl(60, 25%, 95%));--border: 1px solid var(--fg);--base_x1:15px;--half_base:calc(var(--base_x1)/2);--base_x15:calc(var(--base_x1) * 1.5);--base_x2:calc(var(--base_x1)*2);--border: 1px solid var(--fg);--radius: 3px}hr {border: none;height: 1px; background-color: var(--fg);}x-gap {height: 20px;display: block;}* {padding: 0;margin: 0;font-family: monospace;font-size: 15px;line-height: 130%;background: var(--bg);color: var(--fg);outline-color: var(--fg);font-size-adjust: ex-height 0.53;box-sizing: border-box;}hr {margin-bottom: 1ch;}main, .no_select{user-select: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;cursor: default;}textarea{width: 100%;border: var(--border);padding: 1ch;border-radius: var(--radius);resize: none;}html,body{background-color: var(--bg);width: 100vw;height: 100dvh;min-height: 100dvh;}header{margin: 2ch;}body {padding: 0ch 2ch;max-width: 72ch;margin:0 auto;display: flex;flex-direction: column;}main {position: relative;overflow: hidden;height: 0px;flex: 1 1 auto;}#file_picker::after{content: "Drop EPUBS anywhere to load them";font-size: 24px;padding: 1ch;display: block;position: fixed;top: 0;left: 0;text-align: center;width: 100dvw;z-index:99;opacity: 0;pointer-events: none;}#file_picker.drag::after{pointer-events: all;opacity: 1;color: var(--bg);background-color:var(--fg);}button {border-radius: var(--radius);border:var(--border);padding: 0 3px;}main button {width: 100%;margin-bottom: 1ch;}button:active {background-color: var(--fg);color: var(--bg);}button:hover {border: var(--border);}input[type='file']{padding: 3px;width: 100%;margin-bottom: 1ch;border: 1px dashed var(--fg);border-radius: var(--radius);}footer{button {border-color: transparent;}padding: 1ch 0;text-align: center;}footer,small, footer *{font-size: 12px;}p{margin-bottom: 1ch;}summary{border: var(--border);border-color: transparent;}summary:hover {border: 1px dashed var(--fg);}details div {border: 1px solid var(--fg);padding: 1ch 1ch 0ch 1ch;}[popover]{border-radius: var(--radius);position: fixed;inset: 0;height: fit-content;margin: 2ch auto;border: solid;padding: 0.25em;overflow: auto;background-color: var(--bg);width: 66ch;min-height: 6ch;border: 2px solid var(--fg);padding: 2ch;max-width: 90dvw;max-height: 90dvh;pre{white-space: pre-wrap;}button{width: 100%;display: block;margin-bottom: 2px;}}h1,h2,h3,h4{text-align: center;margin-bottom: 1ch;}h3 {font-weight: normal;}h1 {text-transform: uppercase;}small{display: block;width: 100%;text-align: right;}</style><title>Tbook — Folder per book, text file per section</title><meta name="description" content="This tool converts epubs to tbooks and saves one zip file per run."></head><body><header><h1>Batch Convert EPUBS to Tbooks</h1></header><div><label title="This option only suits English texts" for="make_content_ascii">Make content ASCII <input type="checkbox" id="make_content_ascii"></label></div><input type="file" id="file_picker" accept=".epub" multiple="multiple" autofocus=""><small>(NOTE: The tool remains untested for large batch runs)</small><textarea id="textarea_txt_holder" placeholder="Any messages from the tool will appear here."></textarea><button id="save_button" disabled="" hidden="">Save TAR</button><x-gap></x-gap><p>A Tbook consists of an archived or regular folder that holds sequential MD or TXT text files. The folder represents a book and each file represents a section in the book. The file names control the section order. The folder may also contain an optional metadata file. Books with nested structures may use sub folders for hierarchy.
</p><footer><button popovertarget="popover_license">License | By + ©</button><a href="https://gregabbott.pages.dev/">Greg Abbott</a> 2024 - 2025 | <a href="log.html">Log</a> | <a href="https://github.com/gregabbott/tbook">GitHub</a></footer><div popover="" id="popover_license"><p>V1: 2024-11-11 (YMD)<br>
V : 2025_0524<br>
By and Copyright (c) 2024 + 2025 <a href="https://gregabbott.pages.dev/">Greg Abbott</a><br> All rights reserved.<br></p><hr><p>The MIT License</p><p>
Copyright (c) 2024 - 2025, Greg Abbott</p><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p><p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p><p><b>NO WARRANTY</b><br> THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p><hr><h2>The EPUB to TBOOK converter currently uses</h2><p><b>fflate</b> (v0.8.2): To Unzip<br><a href="https://github.com/101arrowz/fflate?tab=MIT-1-ov-file#readme">
MIT License Permission</a> Copyright (c) 2023 Arjun Barrett
</p><p><b>Turndown</b> (v7.2.0): To convert HTML to Markdown<br><a href="https://github.com/mixmark-io/turndown?tab=MIT-1-ov-file#readme">
MIT License Permission</a> Copyright (c) 2017 Dom Christie
<br></p></div><script>
</script><script>/* tar.js */
const tar_lib=(()=>{function t({blob:t,name:e}){let a=document;const n=a.createElement("a");n.href=URL.createObjectURL(t),n.download=e,a.body.appendChild(n),n.click(),a.body.removeChild(n)}const e=(t,e="")=>{const a=new TextEncoder;let n=[];return t.forEach((({name:t,data:r,date:o,path:c=""})=>{let d=(t=>{if(!t.startsWith("data:"))return!1;const e=t.indexOf(",");if(e<0)return!1;const a=t.slice(5,e);return!!/;base64$/i.test(a)})(r)?(t=>{const e=atob(t.split(",")[1]),a=e.length,n=new Uint8Array(a);for(let t=0;t<a;t++)n[t]=e.charCodeAt(t);return n})(r):a.encode(r);const i=e?`${e}/${c}${t}`:`${c}${t}`,l=o?new Date(o):new Date;n.push(((t,e,a)=>{let n=t,r=a;const o=e.toString(8).padStart(11,"0")+"\0",c=new TextEncoder,d=t=>c.encode(t),i=new Uint8Array(512);var l;[[c.encode(n).slice(0,100),0],[d(o),124],[d((l=r,Math.floor(new Date(l).getTime()/1e3).toString(8).padStart(11,"0")+"\0")),136],[d("0000777\0"),100],[d("0000000\0"),108],[d("0000000\0"),116],[d("ustar  \0"),257]].forEach((t=>i.set(...t)));const s=i.reduce(((t,e)=>t+e),0)+256;return i.set(d(s.toString(8).padStart(6,"0")+"\0 "),148),i})(i,d.length,l),d),n.push(new Uint8Array((512-d.length%512)%512))})),n.push(new Uint8Array(512),new Uint8Array(512)),n},a=(t,a)=>n(e(t,a)),n=t=>new Blob(t,{type:"application/x-tar"});return{data_to_tar_blob:a,data_to_tar_data:e,data_to_tar_download:({files:e,extracted_name:n,archived_name:r})=>{t({blob:a(e,n),name:r+".tar"})},save_blob:t}})();
/* process_text.js */
function process_text({ascii_wanted:e=!1}){return n=>{return t(n,(function(e){let n=" ",i=" ",c=" ",t=" ",r="​",a="‌",o="‍",u=" ";const g={[n]:u,[i]:u,[c]:u,[t]:u,[r]:"",[a]:"",[o]:""},F=RegExp(`[${Object.keys(g).join("")}]`,"g");return e.replace(F,(e=>g[e]||""))}),(function(e){return e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"")}),(i=e,c=function(e){return t(e,u,a,r,o,g)},e=>i?c(e):e),(function(e){return e.replace(/\n[ \t]+\n/g,"\n\n")}),(function(e){return e.replace(/\n{3,}/g,"\n\n")}),(function(e){return e.replace(/([!\.?]) {2,}/g,"$1 ")}),(function(e){return e.replace(/[ \t]+\n/g,"\n")}));var i,c;function t(e,...n){return n.reduce(((e,n)=>n(e)),e)}function r(e){const n={"🙂":"Slightly Smiling Face","😀":"Grinning Face","😁":"Beaming Face with Smiling Eyes","😂":"Face with Tears of Joy","😃":"Grinning Face with Big Eyes","😄":"Grinning Face with Smiling Eyes","😅":"Grinning Face with Sweat","😆":"Grinning Squinting Face","😉":"Winking Face","😊":"Smiling Face with Smiling Eyes","😇":"Smiling Face with Halo","🥰":"Smiling Face with Hearts","😍":"Smiling Face with Heart-Eyes","😋":"Face Savoring Food","😎":"Smiling Face with Sunglasses","😏":"Smirking Face","😒":"Unamused Face","😞":"Disappointed Face","😔":"Pensive Face","😟":"Worried Face","😠":"Angry Face","😡":"Pouting Face","😢":"Crying Face","😭":"Loudly Crying Face","😤":"Face with Steam From Nose","😩":"Weary Face","😬":"Grimacing Face","😱":"Face Screaming in Fear","😳":"Flushed Face","😵":"Dizzy Face","😶":"Face Without Mouth","🤔":"Thinking Face","🤗":"Hugging Face","🤩":"Star-Struck","🥳":"Party Face"};return e.replace(/[\u{1F600}-\u{1F64F}]/gu,(e=>n[e]?`(Emoji of ${n[e]})`:"(Unknown Emoji)"))}function a(e){const n={"⓪⓿":"0","①❶":"1","②❷":"2","③❸":"3","④❹":"4","⑤❺":"5","⑥❻":"6","⑦❼":"7","⑧❽":"8","⑨❾":"9","⑩❿":"10","⑪⓫":"11","⑫⓬":"12","⑬⓭":"13","⑭⓮":"14","⑮⓯":"15","⑯⓰":"16","⑰⓱":"17","⑱⓲":"18","⑲⓳":"19","⑳⓴":"20","⧁":">","⧀":"<","Ⓐ":"A","Ⓑ":"B","Ⓒ":"C","Ⓓ":"D","Ⓔ":"E","Ⓕ":"F","Ⓖ":"G","Ⓗ":"H","Ⓘ":"I","Ⓙ":"J","Ⓚ":"K","Ⓛ":"L","Ⓜ":"M","Ⓝ":"N","Ⓞ":"O","Ⓟ":"P","Ⓠ":"Q","Ⓡ":"R","Ⓢ":"S","Ⓣ":"T","Ⓤ":"U","Ⓥ":"V","Ⓦ":"W","Ⓧ":"X","Ⓨ":"Y","Ⓩ":"Z","ⓐ":"a","ⓑ":"b","ⓒ":"c","ⓓ":"d","ⓔ":"e","ⓕ":"f","ⓖ":"g","ⓗ":"h","ⓘ":"i","ⓙ":"j","ⓚ":"k","ⓛ":"l","ⓜ":"m","ⓝ":"n","ⓞ":"o","ⓟ":"p","ⓠ":"q","ⓡ":"r","ⓢ":"s","ⓣ":"t","ⓤ":"u","ⓥ":"v","ⓦ":"w","ⓧ":"x","ⓨ":"y","ⓩ":"z"},i=RegExp(`[${Object.keys(n).join("")}]`,"g");return e.replace(i,(e=>{for(let i in n)if(i.includes(e))return`(${n[i]})`}))}function o(e){const n={"█":"[]","ÀÁÂÃÄÅĀĂĄǍǞǠǺȀȂȦȺḀẠẢẤẦẨẪẬẮẰẲẴẶⒶⱯＡ":"A","Ꜳ":"AA","ÆǢǼ":"AE","Ꜵ":"AO","Ꜷ":"AU","ꜸꜺ":"AV","Ꜽ":"AY","ƁƂɃḂḄḆⒷＢ":"B","ÇĆĈĊČƇȻḈⒸꜾＣ":"C","ÐĎĐƉƊƋḊḌḎḐḒⒹꝹＤ":"D","ǄǅǱ":"DZ","ǅǲ":"Dz","ÈÉÊËĒĔĖĘĚƎƐȄȆȨḔḖḘḚḜẸẺẼẾỀỂỄỆⒺＥ":"E","ƑḞⒻꝻＦ":"F","ĜĞĠĢƓǤǦǴḠⒼꝽꝾꞠＧ":"G","ĤĦȞḢḤḦḨḪⒽⱧⱵꞍＨ":"H","ÌÍÎÏĨĪĬĮİƗǏȈȊḬḮỈỊⒾＩ":"I","ĴǰɈⒿＪ":"J","ĶƘǨḰḲḴⓀⱩꝀꝂꝄꞢＫ":"K","ĹĻĽĿŁȽḶḸḺḼⓁⱠⱢꝆꝈꞀＬ":"L","Ǉǈ":"LJ","ǈ":"Lj","ƜḾṀṂⓂⱮＭ":"M","ÑŃŅŇŊƝǸȠṄṆṈṊⓃꞐꞤＮ":"N","Ǌǋ":"NJ","ǋ":"Nj","ÒÓÔÕÖØŌŎŐƆƟƠǑǪǬǾȌȎȪȬȮȰṌṎṐṒỌỎỐỒỔỖỘỚỜỞỠỢⓄꝊꝌＯ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","ƤṔṖⓅⱣꝐꝒꝔＰ":"P","ɊⓆꝖꝘＱ":"Q","ŔŖŘȐȒɌṘṚṜṞⓇⱤꝚꞂꞦＲ":"R","ŚŜŞŠȘṠṢṤṦṨẞⓈⱾꞄꞨＳ":"S","ŢŤŦƬƮȚȾṪṬṮṰⓉꞆＴ":"T","Ꜩ":"TZ","ÙÚÛÜŨŪŬŮŰŲƯǓǕǗǙǛȔȖɄṲṴṶṸṺỤỦỨỪỬỮỰⓊＵ":"U","ƲɅṼṾⓋꝞＶ":"V","Ꝡ":"VY","ŴẀẂẄẆẈⓌⱲＷ":"W","ẊẌⓍＸ":"X","ÝŶŸƳȲɎẎỲỴỶỸỾⓎＹ":"Y","ŹŻŽƵȤẐẒẔⓏⱫⱿꝢＺ":"Z","àáâãäåāăąǎǟǡǻȁȃȧɐḁẚạảấầẩẫậắằẳẵặⓐⱥａ":"a","ꜳ":"aa","æǣǽ":"ae","ꜵ":"ao","ꜷ":"au","ꜹꜻ":"av","ꜽ":"ay","ƀƃɓḃḅḇⓑｂ":"b","çćĉċčƈȼḉↄⓒꜿｃ":"c","ðďđƌɖɗḋḍḏḑḓⓓꝺｄ":"d","ǆǳ":"dz","èéêëēĕėęěǝȅȇȩɇɛḕḗḙḛḝẹẻẽếềểễệⓔｅ":"e","ƒḟⓕꝼｆ":"f","ĝğġģǥǧǵɠᵹḡⓖꝿꞡｇ":"g","ĥħȟɥḣḥḧḩḫẖⓗⱨⱶｈ":"h","ƕ":"hv","ìíîïĩīĭįıǐȉȋɨḭḯỉịⓘｉ":"i","ĵǰɉⓙｊ":"j","ķƙǩḱḳḵⓚⱪꝁꝃꝅꞣｋ":"k","ĺļľŀłſƚɫḷḹḻḽⓛⱡꝇꝉꞁｌ":"l","ǉ":"lj","ɯɱḿṁṃⓜｍ":"m","ñńņňŉŋƞǹɲṅṇṉṋⓝꞑꞥｎ":"n","ǌ":"nj","òóôõöøōŏőơǒǫǭǿȍȏȫȭȯȱɔɵṍṏṑṓọỏốồổỗộớờởỡợⓞꝋꝍｏ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ƥᵽṕṗⓟꝑꝓꝕｐ":"p","ɋⓠꝗꝙｑ":"q","ŕŗřȑȓɍɽṙṛṝṟⓡꝛꞃꞧｒ":"r","ßśŝşšșȿṡṣṥṧṩẛⓢꞅꞩｓ":"s","ţťŧƭțʈṫṭṯṱẗⓣⱦꞇｔ":"t","ꜩ":"tz","ùúûüũūŭůűųưǔǖǘǚǜȕȗʉṳṵṷṹṻụủứừửữựⓤｕ":"u","ʋʌṽṿⓥꝟｖ":"v","ꝡ":"vy","ŵẁẃẅẇẉẘⓦⱳｗ":"w","ẋẍⓧｘ":"x","ýÿŷƴȳɏẏẙỳỵỷỹỿⓨｙ":"y","źżžƶȥɀẑẓẕⓩⱬꝣｚ":"z","Œ":"OE","ẞ":"SS","œ":"oe","ß":"ss"},i=RegExp(`[${Object.keys(n).join("")}]`,"g");return e.replace(i,(e=>{for(let i in n)if(i.includes(e))return n[i]}))}function u(e){const n="“",i="”",c="‘",t="’",r="…",a="•",o="©",u="®",g="™",F="–",l="—",s={[n]:'"',[i]:'"',[c]:"'",[t]:"'",[F]:"-",[l]:"-",[r]:"...","£":"GBP","«":'"',"»":'"',"‹":"'","›":"'",[a]:"*",[o]:"(c)",[u]:"(R)",[g]:"(TM)"},S=RegExp(`[${Object.keys(s).join("")}]`,"g");return e.replace(S,(e=>s[e]||""))}function g(e){return e.replace(/[^\x00-\x7F]/g,"")}}}
/* turndown.7.2.0.js */
var TurndownService=function(){"use strict";function e(e,n){return Array(n+1).join(e)}var n=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function t(e){return a(e,n)}var r=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function i(e){return a(e,r)}var o=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function a(e,n){return n.indexOf(e.nodeName)>=0}function l(e,n){return e.getElementsByTagName&&n.some((function(n){return e.getElementsByTagName(n).length}))}var u={};function c(e){return e?e.replace(/(\n+\s*)+/g,"\n"):""}function s(e){for(var n in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[n])}function f(e,n,t){for(var r=0;r<e.length;r++){var i=e[r];if(d(i,n,t))return i}}function d(e,n,t){var r=e.filter;if("string"==typeof r){if(r===n.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(n.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof r)throw new TypeError("`filter` needs to be a string, array, or function");if(r.call(e,n,t))return!0}}function p(e){var n=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),n}function h(e,n,t){return e&&e.parentNode===n||t(n)?n.nextSibling||n.parentNode:n.firstChild||n.nextSibling||n.parentNode}u.paragraph={filter:"p",replacement:function(e){return"\n\n"+e+"\n\n"}},u.lineBreak={filter:"br",replacement:function(e,n,t){return t.br+"\n"}},u.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(n,t,r){var i=Number(t.nodeName.charAt(1));return"setext"===r.headingStyle&&i<3?"\n\n"+n+"\n"+e(1===i?"=":"-",n.length)+"\n\n":"\n\n"+e("#",i)+" "+n+"\n\n"}},u.blockquote={filter:"blockquote",replacement:function(e){return"\n\n"+(e=(e=e.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},u.list={filter:["ul","ol"],replacement:function(e,n){var t=n.parentNode;return"LI"===t.nodeName&&t.lastElementChild===n?"\n"+e:"\n\n"+e+"\n\n"}},u.listItem={filter:"li",replacement:function(e,n,t){e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var r=t.bulletListMarker+"   ",i=n.parentNode;if("OL"===i.nodeName){var o=i.getAttribute("start"),a=Array.prototype.indexOf.call(i.children,n);r=(o?Number(o)+a:a+1)+".  "}return r+e+(n.nextSibling&&!/\n$/.test(e)?"\n":"")}},u.indentedCodeBlock={filter:function(e,n){return"indented"===n.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,n,t){return"\n\n    "+n.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},u.fencedCodeBlock={filter:function(e,n){return"fenced"===n.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(n,t,r){for(var i,o=((t.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],a=t.firstChild.textContent,l=r.fence.charAt(0),u=3,c=RegExp("^"+l+"{3,}","gm");i=c.exec(a);)i[0].length>=u&&(u=i[0].length+1);var s=e(l,u);return"\n\n"+s+o+"\n"+a.replace(/\n$/,"")+"\n"+s+"\n\n"}},u.horizontalRule={filter:"hr",replacement:function(e,n,t){return"\n\n"+t.hr+"\n\n"}},u.inlineLink={filter:function(e,n){return"inlined"===n.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,n){var t=n.getAttribute("href");t&&(t=t.replace(/([()])/g,"\\$1"));var r=c(n.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+e+"]("+t+r+")"}},u.referenceLink={filter:function(e,n){return"referenced"===n.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,n,t){var r,i,o=n.getAttribute("href"),a=c(n.getAttribute("title"));switch(a&&(a=' "'+a+'"'),t.linkReferenceStyle){case"collapsed":r="["+e+"][]",i="["+e+"]: "+o+a;break;case"shortcut":r="["+e+"]",i="["+e+"]: "+o+a;break;default:var l=this.references.length+1;r="["+e+"]["+l+"]",i="["+l+"]: "+o+a}return this.references.push(i),r},references:[],append:function(e){var n="";return this.references.length&&(n="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),n}},u.emphasis={filter:["em","i"],replacement:function(e,n,t){return e.trim()?t.emDelimiter+e+t.emDelimiter:""}},u.strong={filter:["strong","b"],replacement:function(e,n,t){return e.trim()?t.strongDelimiter+e+t.strongDelimiter:""}},u.code={filter:function(e){var n=e.previousSibling||e.nextSibling,t="PRE"===e.parentNode.nodeName&&!n;return"CODE"===e.nodeName&&!t},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var n=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",t="`",r=e.match(/`+/gm)||[];-1!==r.indexOf(t);)t+="`";return t+n+e+n+t}},u.image={filter:"img",replacement:function(e,n){var t=c(n.getAttribute("alt")),r=n.getAttribute("src")||"",i=c(n.getAttribute("title"));return r?"!["+t+"]("+r+(i?' "'+i+'"':"")+")":""}},s.prototype={add:function(e,n){this.array.unshift(n)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){return e.isBlank?this.blankRule:(n=f(this.array,e,this.options))||(n=f(this._keep,e,this.options))||(n=f(this._remove,e,this.options))?n:this.defaultRule;var n},forEach:function(e){for(var n=0;n<this.array.length;n++)e(this.array[n],n)}};var g,m,v="undefined"!=typeof window?window:{},A=function(){var e=v.DOMParser,n=!1;try{(new e).parseFromString("","text/html")&&(n=!0)}catch(e){}return n}()?v.DOMParser:(g=function(){},function(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch(n){v.ActiveXObject&&(e=!0)}return e}()?g.prototype.parseFromString=function(e){var n=new window.ActiveXObject("htmlfile");return n.designMode="on",n.open(),n.write(e),n.close(),n}:g.prototype.parseFromString=function(e){var n=document.implementation.createHTMLDocument("");return n.open(),n.write(e),n.close(),n},g);function y(e,n){var r;return function(e){var n=e.element,t=e.isBlock,r=e.isVoid,i=e.isPre||function(e){return"PRE"===e.nodeName};if(n.firstChild&&!i(n)){for(var o=null,a=!1,l=null,u=h(l,n,i);u!==n;){if(3===u.nodeType||4===u.nodeType){var c=u.data.replace(/[ \r\n\t]+/g," ");if(o&&!/ $/.test(o.data)||a||" "!==c[0]||(c=c.substr(1)),!c){u=p(u);continue}u.data=c,o=u}else{if(1!==u.nodeType){u=p(u);continue}t(u)||"BR"===u.nodeName?(o&&(o.data=o.data.replace(/ $/,"")),o=null,a=!1):r(u)||i(u)?(o=null,a=!0):o&&(a=!1)}var s=h(l,u,i);l=u,u=s}o&&(o.data=o.data.replace(/ $/,""),o.data||p(o))}}({element:r="string"==typeof e?(m=m||new A).parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html").getElementById("turndown-root"):e.cloneNode(!0),isBlock:t,isVoid:i,isPre:n.preformattedCode?N:null}),r}function N(e){return"PRE"===e.nodeName||"CODE"===e.nodeName}function E(e,n){return e.isBlock=t(e),e.isCode="CODE"===e.nodeName||e.parentNode.isCode,e.isBlank=function(e){return!i(e)&&!function(e){return a(e,o)}(e)&&/^\s*$/i.test(e.textContent)&&!function(e){return l(e,r)}(e)&&!function(e){return l(e,o)}(e)}(e),e.flankingWhitespace=function(e,n){if(e.isBlock||n.preformattedCode&&e.isCode)return{leading:"",trailing:""};var t,r={leading:(t=e.textContent.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/))[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]};return r.leadingAscii&&T("left",e,n)&&(r.leading=r.leadingNonAscii),r.trailingAscii&&T("right",e,n)&&(r.trailing=r.trailingNonAscii),{leading:r.leading,trailing:r.trailing}}(e,n),e}function T(e,n,r){var i,o,a;return"left"===e?(i=n.previousSibling,o=/ $/):(i=n.nextSibling,o=/^ /),i&&(3===i.nodeType?a=o.test(i.nodeValue):r.preformattedCode&&"CODE"===i.nodeName?a=!1:1!==i.nodeType||t(i)||(a=o.test(i.textContent))),a}var R=Array.prototype.reduce,C=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function k(e){if(!(this instanceof k))return new k(e);var n={rules:u,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,n){return n.isBlock?"\n\n":""},keepReplacement:function(e,n){return n.isBlock?"\n\n"+n.outerHTML+"\n\n":n.outerHTML},defaultReplacement:function(e,n){return n.isBlock?"\n\n"+e+"\n\n":e}};this.options=function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}return e}({},n,e),this.rules=new s(this.options)}function b(e){var n=this;return R.call(e.childNodes,(function(e,t){var r="";return 3===(t=new E(t,n.options)).nodeType?r=t.isCode?t.nodeValue:n.escape(t.nodeValue):1===t.nodeType&&(r=D.call(n,t)),S(e,r)}),"")}function O(e){var n=this;return this.rules.forEach((function(t){"function"==typeof t.append&&(e=S(e,t.append(n.options)))})),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function D(e){var n=this.rules.forNode(e),t=b.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(t=t.trim()),r.leading+n.replacement(t,e,this.options)+r.trailing}function S(e,n){var t=function(e){for(var n=e.length;n>0&&"\n"===e[n-1];)n--;return e.substring(0,n)}(e),r=n.replace(/^\n*/,""),i=Math.max(e.length-t.length,n.length-r.length);return t+"\n\n".substring(0,i)+r}return k.prototype={turndown:function(e){if(!function(e){return null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType))}(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var n=b.call(this,new y(e,this.options));return O.call(this,n)},use:function(e){if(Array.isArray(e))for(var n=0;n<e.length;n++)this.use(e[n]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this},addRule:function(e,n){return this.rules.add(e,n),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return C.reduce((function(e,n){return e.replace(n[0],n[1])}),e)}},k}();
/* fflate.0.8.2.js */
var fflate=function(){"use strict";var r=Uint8Array,e=Uint16Array,a=Int32Array,n=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),t=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),i=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=(r,n)=>{for(var t=new e(31),i=0;i<31;++i)t[i]=n+=1<<r[i-1];var o=new a(t[30]);for(i=1;i<30;++i)for(var f=t[i];f<t[i+1];++f)o[f]=f-t[i]<<5|i;return{b:t,r:o}},f=o(n,2),v=f.b,l=f.r;v[28]=258,l[258]=28;var u,s,d=o(t,0),h=d.b,w=(d.r,new e(32768));for(u=0;u<32768;++u)s=(43690&u)>>1|(21845&u)<<1,w[u]=((65280&(s=(61680&(s=(52428&s)>>2|(13107&s)<<2))>>4|(3855&s)<<4))>>8|(255&s)<<8)>>1;var c=(r,a,n)=>{for(var t=r.length,i=0,o=new e(a);i<t;++i)r[i]&&++o[r[i]-1];var f,v=new e(a);for(i=1;i<a;++i)v[i]=v[i-1]+o[i-1]<<1;if(n){f=new e(1<<a);var l=15-a;for(i=0;i<t;++i)if(r[i])for(var u=i<<4|r[i],s=a-r[i],d=v[r[i]-1]++<<s,h=d|(1<<s)-1;d<=h;++d)f[w[d]>>l]=u}else for(f=new e(t),i=0;i<t;++i)r[i]&&(f[i]=w[v[r[i]-1]++]>>15-r[i]);return f},g=new r(288);for(u=0;u<144;++u)g[u]=8;for(u=144;u<256;++u)g[u]=9;for(u=256;u<280;++u)g[u]=7;for(u=280;u<288;++u)g[u]=8;var b=new r(32);for(u=0;u<32;++u)b[u]=5;c(g,9,0);var m=c(g,9,1),y=(c(b,5,0),c(b,5,1)),p=r=>{for(var e=r[0],a=1;a<r.length;++a)r[a]>e&&(e=r[a]);return e},k=(r,e,a)=>{var n=e/8|0;return(r[n]|r[n+1]<<8)>>(7&e)&a},C=(r,e)=>{var a=e/8|0;return(r[a]|r[a+1]<<8|r[a+2]<<16)>>(7&e)},S=r=>(r+7)/8|0,x=(e,a,n)=>((null==a||a<0)&&(a=0),(null==n||n>e.length)&&(n=e.length),new r(e.subarray(a,n))),T=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data","unknown compression method"],z=(r,e,a)=>{var n=Error(e||T[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,z),!a)throw n;return n},E=(e,a,o,f)=>{var l=e.length,u=f?f.length:0;if(!l||a.f&&!a.l)return o||new r(0);var s=!o,d=s||2!=a.i,w=a.i;s&&(o=new r(3*l));var g=e=>{var a=o.length;if(e>a){var n=new r(Math.max(2*a,e));n.set(o),o=n}},b=a.f||0,T=a.p||0,E=a.b||0,A=a.l,U=a.d,D=a.m,F=a.n,M=8*l;do{if(!A){b=k(e,T,1);var I=k(e,T+1,3);if(T+=3,!I){var O=e[(Q=S(T)+4)-4]|e[Q-3]<<8,j=Q+O;if(j>l){w&&z(0);break}d&&g(E+O),o.set(e.subarray(Q,j),E),a.b=E+=O,a.p=T=8*j,a.f=b;continue}if(1==I)A=m,U=y,D=9,F=5;else if(2==I){var q=k(e,T,31)+257,B=k(e,T+10,15)+4,G=q+k(e,T+5,31)+1;T+=14;for(var H=new r(G),J=new r(19),K=0;K<B;++K)J[i[K]]=k(e,T+3*K,7);T+=3*B;var L=p(J),N=(1<<L)-1,P=c(J,L,1);for(K=0;K<G;){var Q,R=P[k(e,T,N)];if(T+=15&R,(Q=R>>4)<16)H[K++]=Q;else{var V=0,W=0;for(16==Q?(W=3+k(e,T,3),T+=2,V=H[K-1]):17==Q?(W=3+k(e,T,7),T+=3):18==Q&&(W=11+k(e,T,127),T+=7);W--;)H[K++]=V}}var X=H.subarray(0,q),Y=H.subarray(q);D=p(X),F=p(Y),A=c(X,D,1),U=c(Y,F,1)}else z(1);if(T>M){w&&z(0);break}}d&&g(E+131072);for(var Z=(1<<D)-1,$=(1<<F)-1,_=T;;_=T){var rr=(V=A[C(e,T)&Z])>>4;if((T+=15&V)>M){w&&z(0);break}if(V||z(2),rr<256)o[E++]=rr;else{if(256==rr){_=T,A=null;break}var er=rr-254;rr>264&&(er=k(e,T,(1<<(tr=n[K=rr-257]))-1)+v[K],T+=tr);var ar=U[C(e,T)&$],nr=ar>>4;if(ar||z(3),T+=15&ar,Y=h[nr],nr>3){var tr=t[nr];Y+=C(e,T)&(1<<tr)-1,T+=tr}if(T>M){w&&z(0);break}d&&g(E+131072);var ir=E+er;if(E<Y){var or=u-Y,fr=Math.min(Y,ir);for(or+E<0&&z(3);E<fr;++E)o[E]=f[or+E]}for(;E<ir;++E)o[E]=o[E-Y]}}a.l=A,a.p=_,a.b=E,a.f=b,A&&(b=1,a.m=D,a.d=U,a.n=F)}while(!b);return E!=o.length&&s?x(o,0,E):o.subarray(0,E)},A="undefined"!=typeof TextDecoder&&new TextDecoder,U=(r,e)=>r[e]|r[e+1]<<8,D=(r,e)=>(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0,F=(r,e)=>D(r,e)+4294967296*D(r,e+4),M=(r,e)=>e+30+U(r,e+26)+U(r,e+28),I=(r,e,a)=>{var n=U(r,e+28),t=((r,e)=>{if(e){for(var a="",n=0;n<r.length;n+=16384)a+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return a}if(A)return A.decode(r);var t=(r=>{for(var e="",a=0;;){var n=r[a++],t=(n>127)+(n>223)+(n>239);if(a+t>r.length)return{s:e,r:x(r,a-1)};t?3==t?(n=((15&n)<<18|(63&r[a++])<<12|(63&r[a++])<<6|63&r[a++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=String.fromCharCode(1&t?(31&n)<<6|63&r[a++]:(15&n)<<12|(63&r[a++])<<6|63&r[a++]):e+=String.fromCharCode(n)}})(r),i=t.s;return(a=t.r).length&&z(8),i})(r.subarray(e+46,e+46+n),!(2048&U(r,e+8))),i=e+46+n,o=D(r,e+20),f=a&&4294967295==o?((r,e)=>{for(;1!=U(r,e);e+=4+U(r,e+2));return[F(r,e+12),F(r,e+4),F(r,e+20)]})(r,i):[o,D(r,e+24),D(r,e+42)],v=f[0],l=f[1],u=f[2];return[U(r,e+10),v,l,t,i+U(r,e+30)+U(r,e+32),u]},O=(r,e)=>E(r,{i:2},e&&e.out,e&&e.dictionary);return{unzipSync:(e,a)=>{for(var n={},t=e.length-22;101010256!=D(e,t);--t)(!t||e.length-t>65558)&&z(13);var i=U(e,t+8);if(!i)return{};var o=D(e,t+16),f=4294967295==o||65535==i;if(f){var v=D(e,t-12);(f=101075792==D(e,v))&&(i=D(e,v+32),o=D(e,v+48))}for(var l=a&&a.filter,u=0;u<i;++u){var s=I(e,o,f),d=s[0],h=s[1],w=s[2],c=s[3],g=s[4],b=M(e,s[5]);o=g,l&&!l({name:c,size:h,originalSize:w,compression:d})||(d?8==d?n[c]=O(e.subarray(b,b+h),{out:new r(w)}):z(14,"unknown compression type "+d):n[c]=x(e,b,b+h))}return n}}}();
/* j.js */
const glob={},el=[...document.querySelectorAll('[id]:not([id=""])')].reduce(((e,t)=>(e[t.id.trim()]=t,e)),{}),turndown_service=new TurndownService({headingStyle:"atx",emDelimiter:"*",strongDelimiter:"**"});function to_markdown(e){return turndown_service.turndown(e)}function log(e){return console.log(e),e}function chain(e,...t){return t.reduce(((e,t)=>t(e)),e)}function gebi(e){return document.getElementById(e)}function plural(e,t){return t+" "+e+(1==t?"":"s")}function add_drag_drop(e){function t(e){return t=>window.addEventListener(t,e,!1)}function r(){e.classList.remove("drag")}["dragenter","dragover","dragleave","drop"].forEach(t((function(e){e.stopPropagation(),e.preventDefault()}))),["dragenter","dragover"].forEach(t((function(){e.classList.add("drag")}))),t(r)("dragleave"),t((function(t){r(),e.files=[...t.dataTransfer.files].reduce(((e,t)=>(e.items.add(t),e)),new DataTransfer).files,read_zips(t.dataTransfer)}))("drop")}function message(e){el.textarea_txt_holder.value=e}function read_zips(e){const t=[...e.files];let r=["application/epub+zip"];const n=t.filter((e=>r.includes(e.type)));if(!n[0])return message("Unaccepted file types");read_zip({i:0,files:n,thenFn:unzip,finallyFn:process_unzipped_files})}function read_zip({i:e,files:t,thenFn:r,finallyFn:n}){const a=t[e];a.full_name=a.name,a.ext=a.name.split(".").pop(),a.base_name=a.full_name.substring(0,a.full_name.lastIndexOf("."));const i=new FileReader;i.onload=()=>{a.data=new Uint8Array(i.result),r(a),delete a.data,e==t.length-1?n(t):read_zip({i:e+1,files:t,thenFn:r,finallyFn:n})},i.readAsArrayBuffer(a)}function unzip(e){function t(e){const t=e=>128==(192&e);let r=0;for(;r<e.length;){const a=(n=e[r])<=127?1:n>=194&&n<=223?2:n>=224&&n<=239?3:n>=240&&n<=244?4:0;if(0===a||r+a>e.length)return!1;if(!e.slice(r+1,r+a).every(t))return!1;r+=a}var n;return!0}const r=fflate.unzipSync(e.data);e.files=[];for(const a in r){if(!r.hasOwnProperty(a))continue;let i={path:a,full_name:a.split("/").pop(),ext:a.split(".").pop(),data:t(r[a])?(n=r[a],new TextDecoder("utf-8").decode(n)):r[a]};i.base_name=i.full_name.substring(0,i.full_name.lastIndexOf(".")),e.files.push(i)}var n;return e}function process_unzipped_files(e){e.forEach(process_book),glob.summary=plural("Converted EPUB",e.length),glob.unzipped=e,message(`Processed ${glob.summary}:\n`+glob.unzipped.reduce(((e,t)=>e+(t.best_name+"\n")),""));let t=[];glob.unzipped.forEach((e=>{e.chapters.forEach((r=>{t.push({name:r.file_name_title+"."+r.processed_ext,data:r.processed_data,path:e.best_name+"/"})}))}));let r=tar_lib.data_to_tar_blob(t,glob.summary);function n(){tar_lib.save_blob({blob:r,name:glob.summary+".tar"})}n(),el.save_button.disabled=!1,el.save_button.hidden=!1,el.save_button.onclick=n}function parse_opf(e){const t=(new DOMParser).parseFromString(e,"application/xml");return t.getElementsByTagName("parsererror").length>0?(log("Error parsing OPF string"),!1):t}function get_meta(e){if(!e)return{};return[...e.querySelectorAll("*")].reduce(((e,t)=>{let r=t.tagName.toLowerCase().startsWith("dc:"),n=void 0!==t.id&&t.id.length>0;if(!(r||n))return e;let a=t.textContent.trim();if(0==a.length)return e;let i=r?t.tagName.replace(/dc:/gi,""):"",l=n?t.id.replace(RegExp(`^${i}-*`,"i"),"").replaceAll("-","_"):"";return e[(i+(r&&l.length>0?"_":"")+l).toLowerCase().trim()]=chain(a,process_text({ascii_wanted:el.make_content_ascii.checked})).trim(),e}),{})}function process_book(e){let t=chain(e.files.filter((e=>"opf"==e.ext))[0].data,parse_opf);e.meta=get_meta(t),e.chapter_order=parse_epub_order(t);let r=e.files.reduce(((e,t)=>["xhtml","html"].includes(t.ext)?(e[t.full_name]=process_chapter(t),e):e),{});const n=(e=>{const t=(e.length+"").length;return e=>(e+"").padStart(t,"0")})(e.chapter_order);e.chapters=e.chapter_order.reduce(((e,t)=>{let a=r[t];return!a||a.is_empty||(e.push(a),a.file_name_title=slugify(n(e.length+"")+(a.title.trim().length>0?" "+a.title:""))),e}),[]);{let t=e.chapters.reduce(((e,t)=>(e.push(t.processed_data),e)),[]).join("\n\n");e.chapters.push({file_name_title:"_single_file_book",processed_data:t,processed_ext:"md"})}e.chapters.push({file_name_title:"00 Meta",processed_data:JSON.stringify(e.meta,null,"\t"),processed_ext:"json"}),e.best_name=get_best_book_name(e)}function get_best_book_name(e){let t=e.meta.author||e.meta.creator_author||e.meta.creator||e.base_name;return t+" - "+(e.meta.title||(t==e.base_name?"":e.base_name))}function base_name_and_ext_from_path(e){return e.split("/").pop()}function parse_epub_order(e){const t=[...e.querySelectorAll("manifest > item")],r=[...e.querySelectorAll("spine > itemref")],n=t.reduce(((e,t)=>{const r=base_name_and_ext_from_path(t.getAttribute("href"));return e[t.getAttribute("id")]=r,e}),{});return r.map((e=>n[e.getAttribute("idref")]))}function slugify(e){if("string"!=typeof e)return"";let t=e.trim();return 0===t.length?"":(t=t.toLowerCase().replace(/\s+/g,"-").replace(/[^A-Za-z0-9_-]/g,"").replace(/-+/g,"-").replace(/^[-_]+|[-_]+$/g,"").replace(/^[^A-Za-z0-9]+/,"").replace(/[^A-Za-z0-9]+$/,"").replaceAll("-"," "),t&&/^[A-Za-z0-9].*[A-Za-z0-9]$/.test(t)?t:"")}function process_chapter(e){const t=(new DOMParser).parseFromString(e.data,"application/xhtml+xml");return e.processed_data=chain(t.body,to_markdown,process_text({ascii_wanted:el.make_content_ascii.checked})).trim(),e.processed_ext="md",e.is_empty=0===e.processed_data.length,e.is_empty||(e.title=[...t.body.querySelectorAll("h1,h2,h3,h4,h5,h6")].map((e=>e.textContent.trim())).filter((e=>e.length>0))[0]?.trim()||"",e.title=process_text({ascii_wanted:!0})(e.title)),e}el.file_picker.addEventListener("change",(e=>read_zips(e.target))),add_drag_drop(el.file_picker);</script></body></html>